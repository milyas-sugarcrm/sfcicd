<aura:component
  controller="OppLineItemNavController"
  implements="force:lightningQuickActionWithoutHeader,force:appHostable,lightning:actionOverride,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes"
  access="global"
>
  <aura:attribute
    name="purchaseOrderProofsDetails"
    type="String[]"
    default=""
  />
  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
  <aura:attribute name="contentDocumentId" type="String" default="" />
  <aura:attribute name="fileName" type="String" default="" />
  <aura:handler event="c:RefreshPurchaseOrderProofs" action="{!c.refresh}" />
  <aura:handler event="force:refreshView" action="{!c.doInit}" />

  <aura:attribute name="Spinner" type="Boolean" default="false" />
  <aura:if isTrue="{!v.Spinner}">
    <lightning:spinner variant="brand" size="large" />
  </aura:if>
  <aura:html tag="style">
    .showDetails{ display:block; } .hideCom{ display:none; }
  </aura:html>
  <aura:iteration items="{!v.purchaseOrderProofsDetails}" var="proofDetails">
    <div style="width: 50%; float: left">
      <p
        style="
          font-weight: bold;
          padding-left: 0.9375rem;
          padding-right: 0.9375rem;
        "
      >
        PO #{!proofDetails.purchaseOrderNumber} Supplier :
        {!proofDetails.supplier}
      </p>
    </div>
    <div style="width: 29.5%; float: right">
      <div style="float: left">
        <lightning:input
          aura:id="allProofUploaded"
          name="{!proofDetails.purchaseOrderId}"
          onchange="{!c.hideUploadFileOption}"
          checked="{!proofDetails.allProofUploadedStatus}"
          type="checkbox"
        />
      </div>
      <p style="float: left">All Proofs Uploaded</p>
      <div
        style="
          margin-right: 25px; /* width: 30%; */
          text-align: center;
          float: right; /* font-size: .6rem; */
        "
      >
        <div
          class="slds-form-element__control showDetails"
          aura:Id="fileUploadLightning"
          name="{!proofDetails.purchaseOrderId}"
        >
          <lightning:fileUpload
            name="{!proofDetails.purchaseOrderId}"
            label="Upload Proof"
            multiple="false"
            accept=" .jpg, .png"
            required="true"
            recordId="{!proofDetails.purchaseOrderId}"
            aura:id="editfileId"
            onuploadfinished="{!c.handleUploadFinished}"
          />
        </div>
      </div>
    </div>

    <table
      class="slds-table slds-table_cell-buffer slds-no-row-hover slds-is-selected"
    >
      <tbody>
        <aura:iteration items="{!proofDetails.proofs}" var="proof">
          <tr>
            <th style="width: 20%">
              <div style="width: 60%; height: 60%">
                <lightning:carousel disableAutoScroll="true">
                  <lightning:carouselImage
                    src="{!$Label.c.ContentVersionImage+proof.contentVersionId}"
                    class="slds-p-top_none"
                    header=""
                    description=""
                    alternativeText=""
                    style="width: 30%; height: 30%"
                  >
                  </lightning:carouselImage>
                </lightning:carousel>
              </div>
            </th>
            <td style="width: 50%">
              <p style="font-weight: bold">{!proof.fileName}</p>
              <div style="width: 30.5%" class="slds-truncate">
                <lightning:select
                  aura:id="proofPicklist"
                  name="{!proof.proofId}"
                  value="{!proof.status}"
                  onchange="{!c.proofPicklistStatusChange}"
                >
                  <option value="Proof Received">Proof Received</option>
                  <option value="Pending Approval">Pending Approval</option>
                  <option value="Change Requested">Change Requested</option>
                  <option value="Client Approved">Client Approved</option>
                  <option value="Proofing Complete">Proofing Complete</option>
                </lightning:select>
                <!--      Date__c, User__c, Comment__c       <a style="margin-right: 10px; font-size: 100%; color: #2687DF;">Download</a>
                            <a style="margin-right: 10px; font-size: 100%; color: #2687DF;">Replace</a>
                            <a style="margin-right: 10px; font-size: 100%; color: #2687DF;">Delete</a>-->
              </div>
            </td>
            <td>
              <lightning:textarea
                value=""
                aura:id="commentTextarea"
                name="{!proof.proofId}"
                placeholder="Comment on this proof"
              />
              <div
                style="
                  width: 30%;
                  text-align: center;
                  float: right;
                  font-size: 0.6rem;
                "
              >
                <lightning:button
                  name="{!proof.proofId}"
                  onclick="{!c.addCommentForProof}"
                  class="slds-button slds-button_brand"
                >
                  Comment</lightning:button
                >
              </div>
              <br /><br />
              <aura:iteration items="{!proof.comments}" var="comment">
                <p style="float: left; font-weight: bold">
                  {!comment.User__c}:
                </p>
                <p style="float: right">{!comment.Date__c}</p>
                <br />
                <p>{!comment.Comment__c}</p>
                <br />
              </aura:iteration>
            </td>
          </tr>
        </aura:iteration>
      </tbody>
    </table>
  </aura:iteration>
</aura:component>
