<aura:component
  controller="ShippingOppLineItemController"
  implements="force:appHostable,lightning:actionOverride,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction"
  access="global"
>
  <aura:attribute name="recordId" type="Id" />
  <aura:attribute name="deleteId" type="Id" />
  <aura:attribute name="deletePopup" type="boolean" default="false" />
  <aura:attribute name="shippingRecordId" type="Id" />
  <aura:attribute
    name="openCreatePurchaseOrders"
    type="boolean"
    default="false"
  />
  <aura:attribute name="shippingPopup" type="boolean" default="false" />
  <aura:attribute name="isDeletable" type="boolean" default="true" />
  <aura:attribute name="viewAll" type="boolean" default="true" />
  <aura:attribute name="numOfRecords" type="integer" default="6" />
  <aura:attribute name="effectiveDate" type="String" />
  <aura:handler
    event="c:CloseCreatePurchaseOrder"
    action="{!c.CloseCreatePurchaseOrder}"
  />
  <aura:attribute
    name="SalesOrderRelatedOpportunityLineItems"
    type="String[]"
  />
  <aura:handler
    event="c:CloseSalesOrderPopup"
    action="{!c.closeSalesOrderPopup}"
  />
  <aura:attribute name="Size" type="String" default="0" />
  <aura:attribute name="isOpen" type="boolean" default="false" />
  <aura:attribute name="isDelDialogOpen" type="boolean" default="false" />
  <aura:attribute name="Spinner" type="boolean" default="false" />
  <aura:attribute name="errors" type="List" />
  <aura:attribute name="isNew" type="boolean" />
  <aura:attribute name="Error" type="String" />

  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
  <aura:html tag="style">
    @media(max-width: 1250px) { .slds-modal__content{ padding-bottom:0px; } }
  </aura:html>
  <!--loading spinner start... style=Brand Medium (blue dots)-->
  <aura:if isTrue="{!v.Spinner}">
    <div class="slds-p-horizontal--small slds-size--1-of-1">
      <div class="slds-p-horizontal--small slds-size--1-of-1 isActivityLoading">
        <lightning:spinner variant="brand" size="small" />
      </div>
    </div>
  </aura:if>

  <article class="slds-card slds-card_boundary">
    <div class="slds-card__header slds-grid">
      <header class="slds-media slds-media_center slds-has-flexi-truncate">
        <div class="slds-media__figure">
          <span class="slds-icon_container slds-icon-standard-contact">
            <lightning:icon iconName="standard:account" size="small" />
          </span>
        </div>
        <div class="slds-media__body">
          <h2>
            <a
              href="javascript:void(0)"
              onclick="{!c.gotoRelatedList}"
              class="slds-card__header-link slds-truncate"
            >
              <span class="slds-text-heading_small">Shipping Products </span>
              <aura:if isTrue="{!v.viewAll}"
                ><aura:if isTrue="{!greaterthan(v.Size,6)}">
                  <span
                    class="slds-text-heading--small slds-shrink-none slds-m-right--xx-small"
                    title="Shipping Products"
                  >
                    (6+)</span
                  >
                  <aura:set attribute="else"
                    ><span
                      class="slds-text-heading--small slds-shrink-none slds-m-right--xx-small"
                      title="Shipping Products"
                    >
                      ({!v.Size})</span
                    >
                  </aura:set>
                </aura:if>
                <aura:set attribute="else"
                  ><span
                    class="slds-text-heading--small slds-shrink-none slds-m-right--xx-small"
                    title="Shipping Products"
                  >
                    ({!v.Size})</span
                  ></aura:set
                ></aura:if
              >
            </a>
          </h2>
        </div>
      </header>
      <div class="slds-no-flex">
        <lightning:button onclick="{!c.openCreatePurchaseOrder}"
          >Create Purchase Order</lightning:button
        >
      </div>
    </div>

    <aura:if isTrue="{!not(empty(v.SalesOrderRelatedOpportunityLineItems))}">
      <div class="slds-card__body">
        <table
          class="slds-table slds-table_fixed-layout slds-no-row-hover slds-table_cell-buffer"
        >
          <thead>
            <tr>
              <th scope="col">
                <div class="slds-truncate">Name</div>
              </th>
              <th scope="col">
                <div class="slds-truncate">Supplier Shipping</div>
              </th>
              <th scope="col">
                <div class="slds-truncate">Decorator Shipping</div>
              </th>
              <th scope="col" style="width: 100px">
                <div class="slds-truncate">Action</div>
              </th>
            </tr>
          </thead>

          <tbody>
            <aura:iteration
              items="{!v.SalesOrderRelatedOpportunityLineItems}"
              var="product"
            >
              <tr>
                <td style="white-space: initial">
                  <div class="slds-col">
                    <div title="{!product.Name}">
                      <p>
                        <label
                          class="txt"
                          data-crudaction="Edit"
                          style="color: #006dcc; cursor: pointer"
                          data-value="{!product.oppLineItemId}"
                          onclick="{!c.editShippingProductLineItem}"
                          >{!product.productName}</label
                        >
                      </p>
                    </div>
                  </div>
                </td>

                <td style="white-space: initial">
                  <div class="slds-col">
                    <p class="slds-truncate">
                      <b>Name: </b>{!product.shippingInformationDetails.Name}
                    </p>
                  </div>
                  <div class="slds-col">
                    <p class="slds-truncate">
                      <b>In Hands Date: </b
                      >{!product.shippingInformationDetails.In_Hands_Date__c}
                    </p>
                  </div>
                  <div class="slds-col">
                    <p class="slds-truncate">
                      <b>Ship To: </b
                      >{!product.shippingInformationDetails.Ship_To__c}
                    </p>
                  </div>
                  <div class="slds-col">
                    <p><b>Address: </b>{!product.shippingInfoAddress}</p>
                  </div>
                  <div class="slds-col">
                    <p class="slds-truncate">
                      <b>Method: </b
                      >{!product.shippingInformationDetails.Shipping_Method__c}
                    </p>
                  </div>
                </td>

                <td style="white-space: initial">
                  <aura:if
                    isTrue="{!product.shippingInformationDetails.Ship_To__c == 'Decorator'}"
                  >
                    <div class="slds-col">
                      <p class="slds-truncate">
                        <b>Name: </b>{!product.shippingDetails.Name}
                      </p>
                    </div>
                    <div class="slds-col">
                      <p class="slds-truncate">
                        <b>In Hands Date: </b
                        >{!product.shippingDetails.In_Hands_Date__c}
                      </p>
                    </div>
                    <div class="slds-col">
                      <p class="slds-truncate">
                        <b>Ship To: </b>{!product.shippingDetails.Ship_To__c}
                      </p>
                    </div>
                    <div class="slds-col">
                      <p><b>Address: </b>{!product.shippingAddress}</p>
                    </div>
                    <div class="slds-col">
                      <p class="slds-truncate">
                        <b>Method: </b
                        >{!product.shippingDetails.Shipping_Method__c}
                      </p>
                    </div>
                  </aura:if>
                </td>
                <td>
                  <td style="padding: 0.5rem 0.5rem">
                    <div class="slds-no-flex">
                      <div class="slds-shrink-none">
                        <ui:menu>
                          <ui:menuTriggerLink aura:id="trigger">
                            <a
                              class="slds-button slds-button--icon-x-small slds-button--icon-border-filled CIcon"
                              role="button"
                              title="Show more actions"
                              href="javascript:void(0);"
                            >
                              <span
                                class="slds-icon_container slds-icon-utility-down slds-button__icon forceIcon"
                                data-aura-class="forceIcon"
                              >
                                <span
                                  class="lightningPrimitiveIcon"
                                  data-aura-class="lightningPrimitiveIcon"
                                >
                                  <lightning:icon
                                    iconName="utility:down"
                                    size="xx-small"
                                  />
                                </span>
                                <span class="slds-assistive-text"
                                  >Show more actions</span
                                >
                              </span>
                            </a>
                          </ui:menuTriggerLink>
                          <ui:menuList
                            class="actionMenu CMenu"
                            aura:id="actionMenu"
                            autoPosition="true"
                          >
                            <span
                              class="uiMenuItem"
                              data-crudaction="Edit"
                              data-value="{!product.oppLineItemId}"
                              onclick="{!c.editShippingProductLineItem}"
                            >
                              <a style="color: rgb(0, 112, 210)">Edit</a>
                            </span>
                          </ui:menuList>
                        </ui:menu>
                      </div>
                    </div>
                  </td>
                </td>
              </tr>
            </aura:iteration>
          </tbody>
        </table>
      </div>
      <aura:if isTrue="{!greaterthan(v.Size,6)}">
        <aura:if isTrue="{!v.viewAll}">
          <footer class="slds-card__footer">
            <a href="javascript:void(0)" onclick="{!c.gotoRelatedList}"
              >View All <span class="slds-assistive-text">entity type</span></a
            >
          </footer>
        </aura:if>
      </aura:if>
    </aura:if>
  </article>

  <!-- DELETE POPUP  -->
  <div class="slds-m-around--xx-large" style="margin: 0px !important">
    <!--Use aura:if tag to display Model Box, on the bese of conditions. [isOpen boolean attribute] -->
    <aura:if isTrue="{!v.deletePopup}">
      <!-- https://www.lightningdesignsystem.com/components/lookups/ -->
      <div
        role="dialog"
        tabindex="-1"
        aria-labelledby="header99"
        class="slds-modal slds-fade-in-open"
      >
        <div
          class="slds-modal__container"
          style="height: 110% !important"
          role="document"
          tabindex="0"
        >
          <div class="slds-modal__header">
            <h2
              id="modal-heading-01"
              class="slds-text-heading_medium slds-hyphenate"
            >
              Delete Shipping Record
            </h2>
            <button
              class="slds-button slds-modal__close closeIcon slds-button--icon-bare slds-button--icon-inverse"
              title="Close"
              onclick="{!c.closeDeletePopup}"
            >
              <lightning:icon
                class="crosscss slds-button__icon slds-button--icon--inverse slds-button__icon--large"
                iconName="utility:close"
                size="small"
              />
              <span class="slds-assistive-text">Close this window</span>
            </button>
          </div>
          <aura:if isTrue="{! v.Error != null}">
            <div class="slds-modal__content slds-p-around_medium">
              <p style="color: red">{!v.Error}</p>
            </div>
          </aura:if>
          <div class="slds-modal__content slds-p-around--medium">
            <form class="slds-form--stacked">
              <div class="slds">
                <div class="slds-grid slds-wrap">
                  <div class="slds-col--padded slds-medium-size--1-of-2">
                    <div class="slds-form-element">
                      <div class="slds-form-element__control">
                        Are you sure you want to delete this record?
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="slds-modal__footer">
            <lightning:button
              class="slds-button slds-button--neutral"
              onclick="{!c.closeDeletePopup}"
              >Cancel</lightning:button
            >
            <lightning:button
              class="slds-button slds-button--brand customb"
              onclick="{!c.deleteOpportunityLineItem}"
              >Delete</lightning:button
            >
          </div>
        </div>
      </div>
      <div class="slds-backdrop slds-backdrop--open"></div>
    </aura:if>
  </div>

  <!-- Shipping POPUP  -->
  <div
    class="slds-m-around--xx-large"
    style="margin: 0px !important; padding: 0px"
  >
    <!-- SHOPPING POPUP  -->
    <aura:if isTrue="{!v.shippingPopup}">
      <!-- https://www.lightningdesignsystem.com/components/lookups/ -->
      <div
        role="dialog"
        tabindex="-1"
        aria-labelledby="header99"
        class="slds-modal slds-fade-in-open"
      >
        <div
          class="slds-modal__container"
          style="
            height: 110% !important;
            width: 100% !important;
            max-width: 80rem;
          "
          role="document"
          tabindex="0"
        >
          <div class="slds-modal__header">
            <h2
              style="
                text-align: left;
                display: inline;
                float: left;
                padding-left: 30px;
              "
              id="modal-heading-01"
              class="slds-text-heading_medium slds-hyphenate"
            >
              Editing shipping information
            </h2>
            <h3
              style="
                display: inline;
                float: left;
                padding-top: 4px;
                padding-left: 14px;
              "
            >
              Sales Order In Hands Date: {! v.effectiveDate}
            </h3>
            <button
              class="slds-button slds-modal__close closeIcon slds-button--icon-bare slds-button--icon-inverse"
              title="Close"
              onclick="{!c.closeShippingPopup}"
            >
              <lightning:icon
                class="crosscss slds-button__icon slds-button--icon--inverse slds-button__icon--large"
                iconName="utility:close"
                size="small"
              />
              <span class="slds-assistive-text">Close this window</span>
            </button>
          </div>
          <aura:if isTrue="{! v.Error != null}">
            <div class="slds-modal__content slds-p-around_medium">
              <p style="color: red">{!v.Error}</p>
            </div>
          </aura:if>
          <div
            class="slds-modal__content slds-p-around--large"
            style="padding-bottom: 150px; padding-top: 0px"
          >
            <c:ShippingMainComponent
              parent="{! this }"
              aura:id="shippingMainComponent"
              recordId="{!v.shippingRecordId}"
            ></c:ShippingMainComponent>
          </div>
          <div class="slds-modal__footer">
            <lightning:button
              class="slds-button slds-button--neutral"
              onclick="{!c.closeShippingPopup}"
              >Cancel</lightning:button
            >
            <lightning:button
              class="slds-button slds-button--brand customb"
              onclick="{!c.callSave}"
              >Save</lightning:button
            >
          </div>
        </div>
      </div>
      <div class="slds-backdrop slds-backdrop--open"></div>
    </aura:if>
  </div>

  <!-- CREATE PURCHASE ORDERS POPUP  -->
  <aura:if isTrue="{!v.openCreatePurchaseOrders}">
    <!-- https://www.lightningdesignsystem.com/components/lookups/ -->
    <div
      role="dialog"
      tabindex="-1"
      aria-labelledby="header99"
      class="slds-modal slds-fade-in-open"
    >
      <div
        class="slds-modal__container"
        style="height: auto !important"
        role="document"
        tabindex="0"
      >
        <div class="slds-modal__header">
          <h2
            id="modal-heading-01"
            class="slds-text-heading_medium slds-hyphenate"
          >
            Create Purchase Orders
          </h2>
          <button
            class="slds-button slds-modal__close closeIcon slds-button--icon-bare slds-button--icon-inverse"
            title="Close"
            onclick="{!c.CloseCreatePurchaseOrder}"
          >
            <lightning:icon
              class="crosscss slds-button__icon slds-button--icon--inverse slds-button__icon--large"
              iconName="utility:close"
              size="small"
            />
            <span class="slds-assistive-text">Close this window</span>
          </button>
        </div>
        <div class="slds-modal__content slds-p-around--large">
          <c:CreatePurchaseOrders recordId="{!v.recordId}" />
        </div>
      </div>
    </div>
    <div class="slds-backdrop slds-backdrop--open"></div>
  </aura:if>
</aura:component>
